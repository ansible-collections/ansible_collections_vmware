# Test code for the vmware_host_logbundle module.
# Copyright: (c) 2020, sky-joker <sky.jokerxx@gmail.com>
# GNU General Public License v3.0+ (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt)

- name: reset iSCSI config tasks
  block:
    - vmware_host_iscsi:
        hostname: "{{ vcenter_hostname }}"
        username: "{{ vcenter_username }}"
        password: "{{ vcenter_password }}"
        validate_certs: no
        esxi_hostname: "{{ esxi1 }}"
        iscsi_config:
          alias: ''
          vmhba_name: "{{ vmhba_name }}"
        state: present

    - vmware_host_iscsi:
        hostname: "{{ vcenter_hostname }}"
        username: "{{ vcenter_username }}"
        password: "{{ vcenter_password }}"
        validate_certs: no
        esxi_hostname: "{{ esxi1 }}"
        iscsi_config:
          port_bind:
            - vmk0
          vmhba_name: "{{ vmhba_name }}"
          send_target:
            address: 100.64.0.1
          static_target:
            iscsi_name: iqn.2011-08.com.xxxxxxx:as6104t-8c3e9d.target001
            address: 100.64.0.2
        state: absent

    - vmware_host_iscsi:
        hostname: "{{ vcenter_hostname }}"
        username: "{{ vcenter_username }}"
        password: "{{ vcenter_password }}"
        validate_certs: no
        esxi_hostname: "{{ esxi1 }}"
        state: disabled
